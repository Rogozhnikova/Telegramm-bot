import logging
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup, KeyboardButton, ReplyKeyboardMarkup
from telegram.ext import (
    ApplicationBuilder,
    CommandHandler,
    CallbackQueryHandler,
    MessageHandler,
    filters,
    ContextTypes,
)
from datetime import datetime, timedelta
from dotenv import load_dotenv
import os

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

# –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
load_dotenv()
BOT_TOKEN = os.getenv("BOT_TOKEN")


# –°–ø–∏—Å–æ–∫ —à–∞–≥–æ–≤ –∫–≤–µ—Å—Ç–∞ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
quest_steps = [
    {
        "description": "–ù–∞—á–∏–Ω–∞–µ–º –Ω–∞—à–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ",
        "question": "–ü–µ—Ä–≤–∞—è —Ç–æ—á–∫–∞ ‚Äî –ø–∞–º—è—Ç–Ω–∏–∫ –∏–∑–æ–±—Ä–µ—Ç–∞—Ç–µ–ª—é —Ä–∞–¥–∏–æ. –í –∫–∞–∫–æ–º –≥–æ–¥—É –æ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω?",
        "answer_type": "text",  # –¢–∏–ø –æ—Ç–≤–µ—Ç–∞: —Ç–µ–∫—Å—Ç
        "correct_answer": "1975",  # –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç (–≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ)
        "hint": "–≠—Ç–æ—Ç –≥–æ–¥ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –º–µ–∂–¥—É 1970 –∏ 1980.",  # –ü–æ–¥—Å–∫–∞–∑–∫–∞
    },
    {
        "description": "–¢–µ–ø–µ—Ä—å –≤ –∫–æ–Ω—Ü–µ –∞–ª–ª–µ–∏ –Ω–∞–π–¥–∏ –∑–¥–∞–Ω–∏–µ —Å –¥–≤—É–º—è —Ñ–ª–∞–≥–∞–º–∏ –∏ –ø—Ä–æ—á—Ç–∏ —á–µ—Ä–Ω—É—é —Ç–∞–±–ª–∏—á–∫—É –Ω–∞ –Ω–µ–º.",
        "question": "–ö—Ç–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è —Ç–∞–º –Ω–∞ –ø—É—Ç–∏ –∏–∑ –°–∏–±–∏—Ä–∏?",
        "answer_type": "text",  # –¢–∏–ø –æ—Ç–≤–µ—Ç–∞: –≤–∞—Ä–∏–∞–Ω—Ç—ã
        "correct_answer": "–¥–µ–∫–∞–±—Ä–∏—Å—Ç—ã",
    },
    {
        "description": "–†–∞–∑–≤–µ—Ä–Ω–∏—Å—å –Ω–∞ 180 –≥—Ä–∞–¥—É—Å–æ–≤. –°–ø—Ä–∞–≤–∞ –µ—Å—Ç—å –∑–¥–∞–Ω–∏–µ ‚Äî –∏–¥–∏ –∫ –Ω–µ–º—É.",
        "question": "–°–∫–æ–ª—å–∫–æ —ç—Ç–∞–∂–µ–π —ç—Ç–æ –∑–¥–∞–Ω–∏–µ?",
        "answer_type": "text",  # –¢–∏–ø –æ—Ç–≤–µ—Ç–∞: –≤–∞—Ä–∏–∞–Ω—Ç—ã
        "correct_answer": "10",
        "hint": "–∑–¥–∞–Ω–∏–µ –≤—ã—Å–æ–∫–æ–µ –∏ —É –Ω–µ–≥–æ –µ—Å—Ç—å —Ç–∞–±–ª–∏—á–∫–∞, —Ç–∞–º –≤ –ø–µ—Ä–≤—ã—Ö —Å—Ç—Ä–æ—á–∫–∞—Ö –Ω–∞–ø–∏—Å–∞–Ω –æ—Ç–≤–µ—Ç",  # –ü–æ–¥—Å–∫–∞–∑–∫–∞
    },
    {
        "description": "–°–ª–µ–≤–∞ –Ω–∞ —Å–æ—Å–µ–¥–Ω–µ–º –∑–¥–∞–Ω–∏–∏ –±—É–¥–µ—Ç —Ä–∏—Å—É–Ω–æ–∫",
        "question": "–ß—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–æ –ø–æ–¥ —á–∏—Å–ª–æ–º 24?",
        "answer_type": "text",  # –¢–∏–ø –æ—Ç–≤–µ—Ç–∞: –≤–∞—Ä–∏–∞–Ω—Ç—ã
        "correct_answer": "–∞–ª–º–∞–∑–Ω—ã–µ –ø–∞–ª–∫–∏",
        "hint": "–∫–∞–∫–∏–µ-—Ç–æ –ø–∞–ª–∫–∏"
    },
    {
        "description": "–ò–¥–∏ –ø—Ä—è–º–æ –∏ –Ω–∞–π–¥–∏ –≥—Ä–∞—Ñ—Ñ–∏—Ç–∏ '–ú—ã —Å—Ç–∞–Ω–µ–º –ª—É—á—à–µ'",
        "question": "–ö–∞–∫–æ–µ —á–∏—Å–ª–æ –µ—Å—Ç—å —Ä—è–¥–æ–º —Å –Ω–∞–¥–ø–∏—Å—å—é –Ω–∞ —ç—Ç–æ–π –∂–µ —Å—Ç–µ–Ω–µ?",
        "answer_type": "text",  # –¢–∏–ø –æ—Ç–≤–µ—Ç–∞: –≤–∞—Ä–∏–∞–Ω—Ç—ã
        "correct_answer": "180",
        "hint": "—á–∏—Å–ª–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ —Å–ª–æ–≤–∞ '–ª—É—á—à–µ'",  # –ü–æ–¥—Å–∫–∞–∑–∫–∞
    },
    {
        "description": "–ò–¥–µ–º –¥–∞–ª—å—à–µ –ø–æ —É–ª–∏—Ü–µ. –ü–æ –ø—É—Ç–∏ –±—É–¥–µ—Ç –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–µ –∑–¥–∞–Ω–∏–µ",
        "question": "–ö—Ç–æ –∂–∏–ª –≤ —ç—Ç–æ–º –¥–æ–º–µ?",
        "answer_type": "text",  # –¢–∏–ø –æ—Ç–≤–µ—Ç–∞: –≤–∞—Ä–∏–∞–Ω—Ç—ã
        "correct_answer": "–º–∞–º–∏–Ω-—Å–∏–±–∏—Ä—è–∫",
        "hint": "—É–ª–∏—Ü–∞ –ü—É—à–∫–∏–Ω–∞, 27",  # –ü–æ–¥—Å–∫–∞–∑–∫–∞
    },
    {
        "description": "–ß—É—Ç—å –¥–∞–ª—å—à–µ –±—É–¥–µ—Ç –ø–∞–º—è—Ç–Ω–∏–∫ –ü—É—à–∫–∏–Ω—É",
        "question": "–ß—Ç–æ –Ω–∞–ø–∏—Å–∞–Ω–æ –≤–Ω–∏–∑—É?",
        "answer_type": "text",  # –¢–∏–ø –æ—Ç–≤–µ—Ç–∞: –≤–∞—Ä–∏–∞–Ω—Ç—ã
        "correct_answer": "–≤–µ–ª–µ–Ω—å—é –±–æ–∂–∏—é, –æ –º—É–∑–∞, –±—É–¥—å –ø–æ—Å–ª—É—à–Ω–∞...",
        "hint": "—ç—Ç–æ —Å—Ç—Ä–æ—á–∫–∞ –∏–∑ –µ–≥–æ —Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏—è, –æ–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –ø—Ä–æ–±–µ–ª—ã, –∑–∞–ø—è—Ç—ã–µ –∏ —Ç–æ—á–∫–∏",  # –ü–æ–¥—Å–∫–∞–∑–∫–∞
    },
    {
        "description": "–ù–µ –±—É–¥–µ–º —É—Ö–æ–¥–∏—Ç—å –¥–∞–ª–µ–∫–æ. –ò–¥–∏ –ø–æ —É–ª–∏—Ü–µ –ü–µ—Ä–≤–æ–º–∞–π—Å–∫–∞—è –¥–æ —É–ª–∏—Ü—ã –¶–∞—Ä—Å–∫–∞—è",
        "question": "–¢—ã –Ω–∞–π–¥–µ—à—å –∞—Ñ–∏—à—É. –í –Ω–µ–π –µ—Å—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–≤–∞—Ä—Ç–∞–ª–∞. –ù–∞–ø–∏—à–∏ –µ–≥–æ",
        "answer_type": "text",  # –¢–∏–ø –æ—Ç–≤–µ—Ç–∞: –≤–∞—Ä–∏–∞–Ω—Ç—ã
        "correct_answer": "–ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã–π",
    },
    {
        "description": "–ï—Å–ª–∏ —Å—Ç–æ—è—Ç—å –ª–∏—Ü–æ–º –∫ –∞—Ñ–∏—à–µ, —Ç–æ —Å–ª–µ–≤–∞ –±—É–¥–µ—Ç –µ—â–µ –æ–¥–Ω–æ –ø–∞–º—è—Ç–Ω–æ–µ –º–µ—Å—Ç–æ. –ò–¥–∏ –∫ –Ω–µ–º—É",
        "question": "–ö–∞–∫–∞—è —Ñ–∞–º–∏–ª–∏—è –Ω–∞–ø–∏—Å–∞–Ω–∞ —Ç–∞–º?",
        "answer_type": "text",  # –¢–∏–ø –æ—Ç–≤–µ—Ç–∞: –≤–∞—Ä–∏–∞–Ω—Ç—ã
        "correct_answer": "–µ–≥–æ—Ä–æ–≤",
        "hint": "—Ñ–∞–º–∏–ª–∏—è –Ω–∞–ø–∏—Å–∞–Ω–∞ –≤ –ª–µ–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É",  # –ü–æ–¥—Å–∫–∞–∑–∫–∞
    },
    {
        "description": "–ù–∞ –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–∫–µ –Ω–∞–ø—Ä–∞–≤–æ. –î–æ—Ä–æ–≥—É –Ω–µ –ø–µ—Ä–µ—Ö–æ–¥–∏ –∏ –∏–¥–∏ –ø—Ä—è–º–æ",
        "question": "–í—ã–≤–µ—Å–∫–∞ –∫–∞–∫–æ–≥–æ –±–∞—Ä–∞ –≤–∏–¥–Ω–∞?",
        "answer_type": "text",  # –¢–∏–ø –æ—Ç–≤–µ—Ç–∞: –≤–∞—Ä–∏–∞–Ω—Ç—ã
        "correct_answer": "—è–Ω–∫–∏",
    },
    {
        "description": "–ù–∞ –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω–µ –¥–æ—Ä–æ–≥–∏ –±—É–¥–µ—Ç –æ–±—ä–µ–∫—Ç –∫—É–ª—å—Ç—É—Ä–Ω–æ–≥–æ –Ω–∞—Å–ª–µ–¥–∏—è.–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –¥–æ—Ä–æ–≥—É –ø–æ –ø–µ—à–µ—Ö–æ–¥–Ω–æ–º—É –ø–µ—Ä–µ—Ö–æ–¥—É",
        "question": "–ß–µ–π –¥–æ–º? (—É–∫–∞–∂–∏ —Ç–æ–ª—å–∫–æ —Ñ–∞–º–∏–ª–∏—é)",
        "answer_type": "text",  # –¢–∏–ø –æ—Ç–≤–µ—Ç–∞: –≤–∞—Ä–∏–∞–Ω—Ç—ã
        "correct_answer": "—Å–µ–ª–∏–≤–∞–Ω–æ–≤–æ–π",
        "hint": "–Ω—É–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å —Ç–æ—á–Ω–æ —Ç–∞–∫ –∂–µ, –∫–∞–∫ –∏ –≤ —Ç–∞–±–ª–∏—á–∫–µ –Ω–∞ –∑–¥–∞–Ω–∏–∏",  # –ü–æ–¥—Å–∫–∞–∑–∫–∞
    },
    {
        "description": "–ò–¥–∏ –¥–∞–ª—å—à–µ –≤ —Å—Ç–æ—Ä–æ–Ω—É –ø—Ä–æ—Å–ø–µ–∫—Ç–∞ –õ–µ–Ω–∏–Ω–∞. –í–∏–¥–∏—à—å –≥—Ä–∞—Ñ—Ñ–∏—Ç–∏ —Å –º–∏—Å—Ç–∏—á–µ—Å–∫–∏–º–∏ —Å—É—â–µ—Å—Ç–≤–∞–º–∏?",
        "question": "–ö–∞–∫–æ–≥–æ —Ü–≤–µ—Ç–∞ —Ç–æ —Å—É—â–µ—Å—Ç–≤–æ, –∫–æ—Ç–æ—Ä–æ–µ –∏–º–µ–µ—Ç –≤—Å–µ–≥–æ –¥–≤–µ –Ω–æ–≥–∏?",
        "answer_type": "text",  # –¢–∏–ø –æ—Ç–≤–µ—Ç–∞: –≤–∞—Ä–∏–∞–Ω—Ç—ã
        "correct_answer": "–±–µ–ª–æ–≥–æ",
    },
    {
        "description": "–ò–¥–∏ –¥–∞–ª—å—à–µ. –¢—ã –≤—Å—Ç—Ä–µ—Ç–∏—à—å –º–Ω–æ–≥–æ –∫–æ—Ç–∏–∫–æ–≤.",
        "question": "–û–Ω–∏ –¥–≤—É—Ö —Ü–≤–µ—Ç–æ–≤. –ù–æ –∫–∞–∫–æ–≥–æ —Ü–≤–µ—Ç–∞ –±–æ–ª—å—à–µ?",
        "answer_type": "text",  # –¢–∏–ø –æ—Ç–≤–µ—Ç–∞: –≤–∞—Ä–∏–∞–Ω—Ç—ã
        "correct_answer": "–∫—Ä–∞—Å–Ω–æ–≥–æ",
        "hint": "–∫–æ—Ç–∏–∫–∏ —Å–∏–¥—è—Ç –∑–∞ –æ–∫–Ω–æ–º –∏ –º–∞—à—É—Ç –ª–∞–ø–∫–æ–π, –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ —Å–º–æ—Ç—Ä–∏ –ø–æ —Å—Ç–æ—Ä–æ–Ω–∞–º",  # –ü–æ–¥—Å–∫–∞–∑–∫–∞
    },
    {
        "description": "–ó–Ω–∞–µ—à—å, –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –∞–∫–∞–¥–µ–º–∏—è –º—É–∑—ã–∫–∞–ª—å–Ω–æ–π –∫–æ–º–µ–¥–∏–∏?",
        "question": "–ö–∞–∫–æ–≥–æ —Ü–≤–µ—Ç–∞ –∫—Ä—É–∂–∫–∏ –Ω–∞ –¥–≤–µ—Ä—è—Ö?",
        "answer_type": "text",  # –¢–∏–ø –æ—Ç–≤–µ—Ç–∞: –≤–∞—Ä–∏–∞–Ω—Ç—ã
        "correct_answer": "–∂–µ–ª—Ç–æ–≥–æ",
    },
]

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Å –∫–Ω–æ–ø–∫–æ–π "–ü–æ–¥—Å–∫–∞–∑–∫–∞"
def create_keyboard(options=None):
    keyboard = []
    if options:
        keyboard += [[InlineKeyboardButton(option, callback_data=str(i))] for i, option in enumerate(options)]
    keyboard.append([InlineKeyboardButton("–ü–æ–¥—Å–∫–∞–∑–∫–∞ ‚ùì", callback_data="hint")])
    return InlineKeyboardMarkup(keyboard)

# –ì–ª–∞–≤–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ (—Ç–µ–ø–µ—Ä—å –Ω–µ –Ω—É–∂–Ω–∞, –Ω–æ –æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
def create_main_keyboard():
    return ReplyKeyboardMarkup([["–ù–∞—á–∞—Ç—å –∫–≤–µ—Å—Ç"]], resize_keyboard=True)

# –ö–æ–º–∞–Ω–¥–∞ /start
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    await update.message.reply_text(
        "üìå –ù–∞—á–Ω–∏ —Å–≤–æ–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å –∏ –æ—Ç–∫—Ä–æ–π –¥–ª—è —Å–µ–±—è –º–∏—Ä —É–ª–∏—á–Ω—ã—Ö –∫–≤–µ—Å—Ç–æ–≤!\n"
        "üí™ –°–æ–±–µ—Ä–∏ —Å–≤–æ–∏—Ö –¥—Ä—É–∑–µ–π –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–π—Å—è –≤ –ø—É—Ç—å –≤ –æ–¥–∏–Ω–æ—á–∫—É ‚Äî –≥–ª–∞–≤–Ω–æ–µ, –±—É–¥—å –≥–æ—Ç–æ–≤ –∫ –Ω–æ–≤—ã–º –æ—Ç–∫—Ä—ã—Ç–∏—è–º –∏ —è—Ä–∫–∏–º —ç–º–æ—Ü–∏—è–º! üí™\n"
        "üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å —É—á–∞—Å—Ç–∏—è –≤—Å–µ–≥–æ 100 —Ä—É–±–ª–µ–π\n" 
        "(–ù–∞ –æ–¥–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞)"
        "–í —ç—Ç–æ–º –∫–≤–µ—Å—Ç–µ —Ç–µ–±—è –∂–¥—É—Ç –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–≤–µ—Ä—è—Ç —Ç–≤–æ—é —Å–º–µ–∫–∞–ª–∫—É –∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å.\n"
        "–ê –≤ –∫–æ–Ω—Ü–µ —Ç—ã –ø–æ–ª—É—á–∏—à—å –≤–∫—É—Å–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫ üéÅ ",
        reply_markup=create_main_keyboard()
    )
    context.user_data['step'] = 0  # –ù–∞—á–∏–Ω–∞–µ–º –∫–≤–µ—Å—Ç —Å –ø–µ—Ä–≤–æ–≥–æ —à–∞–≥–∞

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É "–ù–∞—á–∞—Ç—å –∫–≤–µ—Å—Ç"
async def handle_quest_start(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    context.user_data['step'] = 0
    await send_step(update, context)

# –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞ –∫–≤–µ—Å—Ç–∞
async def send_step(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    step_index = context.user_data.get('step', 0)
    if step_index < len(quest_steps):
        step = quest_steps[step_index]
        message = f"{step['description']}\n{step['question']}"
        reply_markup = create_keyboard()
        await update.message.reply_text(message, reply_markup=reply_markup)
    else:
        await update.message.reply_text(
            " –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–∏–ª–∏ –∫–≤–µ—Å—Ç –∏ —Ä–∞—Å–∫—Ä—ã–ª–∏ –≤—Å–µ –µ–≥–æ —Ç–∞–π–Ω—ã. –ù–∞–¥–µ–µ–º—Å—è, –≤–∞–º –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å —ç—Ç–æ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ! \n"
            "–ù–∞–≥—Ä–∞–¥—É –≤—ã –º–æ–∂–µ—Ç–µ –≤—ã–±—Ä–∞—Ç—å —Å–∞–º–∏ –∫–æ—Ñ–µ –≤ –ñ–∏–∑–Ω—å–º–∞—Ä—Ç –∏–ª–∏ —á–µ–±—É—Ä–µ–∫ –≤ –ß–µ–±—É—Ä–µ–∫–ú–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è —Ä—è–¥–æ–º - –Ω–∞ –ö–∞—Ä–ª–∞ –õ–∏–±–∫–Ω–µ—Ö—Ç–∞ 22/1")

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –∑–∞–≥–∞–¥–∫—É
async def handle_response(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    step_index = context.user_data.get('step', 0)
    if step_index >= len(quest_steps):
        return

    step = quest_steps[step_index]
    query = update.callback_query

    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–¥—Å–∫–∞–∑–∫–∏
    if query and query.data == "hint":
        hint = step.get("hint", "–ü–æ–¥—Å–∫–∞–∑–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.")
        await query.message.reply_text(f"üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞: {hint}")
        return

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
    user_answer = update.message.text.strip().lower()
    correct_answer = step["correct_answer"].lower()

    if user_answer == correct_answer:
        await update.message.reply_text("‚úÖ –û—Ç–ª–∏—á–Ω–æ! –í–∞—à –æ—Ç–≤–µ—Ç –≤–µ—Ä–µ–Ω. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —ç—Ç–∞–ø—É! ‚úÖ")
        context.user_data['step'] += 1
        await send_step(update, context)
    else:
        await update.message.reply_text("‚ùå –£–ø—Å! –ö–∞–∂–µ—Ç—Å—è, —ç—Ç–æ—Ç –æ—Ç–≤–µ—Ç –Ω–µ–≤–µ—Ä–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑! ‚ùå")

# –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
def main() -> None:
    application = ApplicationBuilder().token(BOT_TOKEN).build()

    # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
    application.add_handler(CommandHandler("start", start))
    application.add_handler(MessageHandler(filters.Regex("–ù–∞—á–∞—Ç—å –∫–≤–µ—Å—Ç"), handle_quest_start))
    application.add_handler(CallbackQueryHandler(handle_response))
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_response))

    # –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
    application.run_polling()

if __name__ == '__main__':
    main()